# NoTab Extension é”™è¯¯ä¿®å¤è¯´æ˜

## ä¿®å¤çš„é—®é¢˜

### 1. Service Worker æ³¨å†Œå¤±è´¥ (çŠ¶æ€ç  15)
**é—®é¢˜åŸå› ï¼š** manifest.json ä¸­ç¼ºå°‘ `commands` å­—æ®µï¼Œä½† service-worker.js ä¸­ä½¿ç”¨äº† `chrome.commands.onCommand` APIã€‚

**ä¿®å¤æ–¹æ¡ˆï¼š**
- åœ¨ manifest.json ä¸­æ·»åŠ äº† `commands` å­—æ®µï¼Œå®šä¹‰äº†ä¸‰ä¸ªé”®ç›˜å¿«æ·é”®ï¼š
  - `Ctrl+Shift+W` (Mac: `Cmd+Shift+W`) - å…³é—­æ‰€æœ‰é¢„è§ˆçª—å£
  - `Ctrl+Shift+C` (Mac: `Cmd+Shift+C`) - å±‚å å¸ƒå±€
  - `Ctrl+Shift+T` (Mac: `Cmd+Shift+T`) - å¹³é“ºå¸ƒå±€

### 2. "Could not establish connection" é”™è¯¯
**é—®é¢˜åŸå› ï¼š** background service worker å‘ content script å‘é€æ¶ˆæ¯æ—¶ï¼Œcontent script è¿˜æ²¡æœ‰å®Œæˆåˆå§‹åŒ–ã€‚

**ä¿®å¤æ–¹æ¡ˆï¼š**
- **content-script.js**: å°† `chrome.runtime.onMessage.addListener` ç§»åˆ°æ–‡ä»¶é¡¶éƒ¨ï¼Œç«‹å³è®¾ç½®æ¶ˆæ¯ç›‘å¬å™¨
- **service-worker.js**: ä¸ºæ‰€æœ‰ `chrome.tabs.sendMessage` è°ƒç”¨æ·»åŠ äº† try-catch é”™è¯¯å¤„ç†
- **service-worker.js**: å°†å›è°ƒå‡½æ•°æ”¹ä¸º async/await æ¨¡å¼ï¼Œæé«˜ä»£ç å¯è¯»æ€§

## æ–‡ä»¶ä¿®æ”¹æ¸…å•

### 1. `/manifest.json`
```json
"commands": {
  "close-all-previews": { ... },
  "cascade-layout": { ... },
  "tile-layout": { ... }
}
```

### 2. `/content/content-script.js`
- âœ… å°†æ¶ˆæ¯ç›‘å¬å™¨ç§»è‡³æ–‡ä»¶é¡¶éƒ¨ï¼ˆç¬¬14-63è¡Œï¼‰
- âœ… åˆ é™¤äº† `listenToBackgroundMessages()` å‡½æ•°
- âœ… æ·»åŠ äº†åˆå§‹åŒ–çŠ¶æ€æ£€æŸ¥ï¼ˆé¿å…æœªåˆå§‹åŒ–æ—¶æ‰§è¡Œæ“ä½œï¼‰

### 3. `/background/service-worker.js`
- âœ… ä¸ºå³é”®èœå•å¤„ç†å™¨æ·»åŠ äº† async/await å’Œé”™è¯¯å¤„ç†ï¼ˆç¬¬98-133è¡Œï¼‰
- âœ… ä¸ºå¿«æ·é”®å¤„ç†å™¨æ·»åŠ äº† async/await å’Œé”™è¯¯å¤„ç†ï¼ˆç¬¬136-164è¡Œï¼‰

## é‡æ–°åŠ è½½æ‰©å±•

1. æ‰“å¼€ Chrome æµè§ˆå™¨ï¼Œè®¿é—® `chrome://extensions/`
2. æ‰¾åˆ° "NoTab Pro Clone" æ‰©å±•
3. ç‚¹å‡»åˆ·æ–°æŒ‰é’® ğŸ”„
4. æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯æç¤º

## åŠŸèƒ½æµ‹è¯•

### æµ‹è¯• 1: å³é”®èœå•
1. æ‰“å¼€ä»»æ„ç½‘é¡µ
2. å³é”®ç‚¹å‡»é¡µé¢ä¸Šçš„é“¾æ¥
3. åº”è¯¥çœ‹åˆ°ä»¥ä¸‹èœå•é¡¹ï¼š
   - âœ… "åœ¨é¢„è§ˆçª—å£ä¸­æ‰“å¼€"
   - âœ… "åœ¨é¢„è§ˆçª—å£ä¸­æ‰“å¼€æ­¤é¡µé¢"
   - âœ… "å…³é—­æ‰€æœ‰é¢„è§ˆçª—å£"

### æµ‹è¯• 2: å¿«æ·é”®
1. æ‰“å¼€ä»»æ„ç½‘é¡µ
2. æŒ‰ä¸‹å¿«æ·é”®ï¼š
   - `Ctrl+Shift+W` - åº”å…³é—­æ‰€æœ‰é¢„è§ˆçª—å£
   - `Ctrl+Shift+C` - åº”åˆ‡æ¢åˆ°å±‚å å¸ƒå±€
   - `Ctrl+Shift+T` - åº”åˆ‡æ¢åˆ°å¹³é“ºå¸ƒå±€

### æµ‹è¯• 3: Content Script åˆå§‹åŒ–
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
2. åˆ‡æ¢åˆ° Console æ ‡ç­¾
3. åˆ·æ–°é¡µé¢
4. åº”è¯¥çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼ˆæ— é”™è¯¯ï¼‰ï¼š
   ```
   NoTab Extension loaded
   Initializing NoTab Extension...
   Settings loaded: {...}
   NoTab Extension initialized successfully
   ```

### æµ‹è¯• 4: é“¾æ¥é¢„è§ˆ
1. æ‰“å¼€ä»»æ„ç½‘é¡µ
2. æŒ‰ä½ `Ctrl` é”®ï¼Œç‚¹å‡»ä»»æ„é“¾æ¥
3. åº”è¯¥å¼¹å‡ºé¢„è§ˆçª—å£

## å·²çŸ¥é™åˆ¶

1. **æŸäº›ç‰¹æ®Šé¡µé¢æ— æ³•æ³¨å…¥ content script**ï¼š
   - Chrome Web Store é¡µé¢ (`chrome.google.com/webstore/`)
   - æµè§ˆå™¨å†…éƒ¨é¡µé¢ (`chrome://`, `edge://` ç­‰)
   - PDF æ–‡ä»¶æŸ¥çœ‹å™¨
   - æœ¬åœ°æ–‡ä»¶ (`file://`)

2. **é¦–æ¬¡å®‰è£…åéœ€è¦åˆ·æ–°é¡µé¢**ï¼š
   - å·²æ‰“å¼€çš„æ ‡ç­¾é¡µä¸ä¼šè‡ªåŠ¨æ³¨å…¥ content script
   - éœ€è¦åˆ·æ–°é¡µé¢æˆ–é‡æ–°æ‰“å¼€æ ‡ç­¾é¡µ

## è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹ Service Worker æ—¥å¿—
1. è®¿é—® `chrome://extensions/`
2. æ‰¾åˆ° "NoTab Pro Clone"
3. ç‚¹å‡» "service worker" é“¾æ¥
4. æŸ¥çœ‹ Console è¾“å‡º

### æŸ¥çœ‹ Content Script æ—¥å¿—
1. åœ¨ç½‘é¡µä¸ŠæŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
2. åˆ‡æ¢åˆ° Console æ ‡ç­¾
3. æŸ¥çœ‹ä»¥ "NoTab" å¼€å¤´çš„æ—¥å¿—

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

| é”™è¯¯ä¿¡æ¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|------|---------|
| `Could not establish connection` | Content script æœªåŠ è½½ | åˆ·æ–°é¡µé¢æˆ–æ£€æŸ¥æ˜¯å¦ä¸ºç‰¹æ®Šé¡µé¢ |
| `Extension not initialized` | æ‰©å±•è¿˜åœ¨åˆå§‹åŒ–ä¸­ | ç­‰å¾…å‡ ç§’åé‡è¯• |
| `Unknown action` | å‘é€äº†ä¸æ”¯æŒçš„æ¶ˆæ¯ | æ£€æŸ¥ä»£ç ä¸­çš„ action åç§° |

## ä¸‹ä¸€æ­¥å¼€å‘å»ºè®®

1. **æ·»åŠ æƒé™æ£€æŸ¥**ï¼šæŸäº› API å¯èƒ½éœ€è¦ç”¨æˆ·æˆæƒ
2. **æ”¹è¿›é”™è¯¯æç¤º**ï¼šå½“åŠŸèƒ½ä¸å¯ç”¨æ—¶ï¼Œå‘ç”¨æˆ·æ˜¾ç¤ºå‹å¥½çš„æç¤º
3. **æ·»åŠ é‡è¯•æœºåˆ¶**ï¼šå½“ content script æœªå‡†å¤‡å¥½æ—¶ï¼Œå¯ä»¥è‡ªåŠ¨é‡è¯•
4. **ä¼˜åŒ–æ€§èƒ½**ï¼šè€ƒè™‘æŒ‰éœ€åŠ è½½æŸäº›æ¨¡å—ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰è„šæœ¬

## æŠ€æœ¯æ¶æ„

```
background/
  â””â”€â”€ service-worker.js     # åå°æœåŠ¡ï¼Œå¤„ç†å³é”®èœå•ã€å¿«æ·é”®

content/
  â”œâ”€â”€ content-script.js     # ä¸»å…¥å£ï¼Œåè°ƒå„æ¨¡å—
  â”œâ”€â”€ link-preview.js       # é“¾æ¥é¢„è§ˆåŠŸèƒ½
  â”œâ”€â”€ preview-manager.js    # é¢„è§ˆçª—å£ç®¡ç†
  â”œâ”€â”€ reader-mode.js        # é˜…è¯»æ¨¡å¼
  â”œâ”€â”€ video-mode.js         # è§†é¢‘æ¨¡å¼
  â”œâ”€â”€ translator.js         # ç¿»è¯‘åŠŸèƒ½
  â””â”€â”€ search.js             # æœç´¢åŠŸèƒ½

utils/
  â”œâ”€â”€ constants.js          # å¸¸é‡å®šä¹‰
  â”œâ”€â”€ event-bus.js          # äº‹ä»¶æ€»çº¿
  â”œâ”€â”€ dom-utils.js          # DOM å·¥å…·
  â””â”€â”€ storage.js            # å­˜å‚¨ç®¡ç†
```

## ç‰ˆæœ¬å†å²

- **v1.0.0** (2024-01-21)
  - åˆå§‹ç‰ˆæœ¬
  - ä¿®å¤ service worker æ³¨å†Œé”™è¯¯
  - ä¿®å¤æ¶ˆæ¯è¿æ¥é”™è¯¯
  - æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
